<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>JavaScript :: Connect Docs</title>
    <link rel="shortcut icon" type="image/png" href="images/favicon.png"/>
    <script src="//use.typekit.net/jyl8gjp.js?t=1438654489102"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <link rel="stylesheet" href="styles/all.min.css"/>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body data-spy="scroll" data-target="#nav-wrapper">
    <header>
      <nav class="header-nav navbar navbar-inverse" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand navbar-brand active" href="./">
              <div class="docs-logo-small"></div>
            </a>
          </div>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a class="return" href="https://app.getconnect.io"><i class="ion-arrow-return-left"></i> Return to portal</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    
    <div class="white-background-panel">
<div class="container">
  <div class="row">
    <div class="col-sm-3">
      <nav data-spy="affix" id="nav-wrapper" class="hidden-xs" data-offset-top="60" data-offset-bottom="400">
        <ul class="nav switcher">
          <li class="dropdown active">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">JavaScript<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li>
                  <a href="js">JavaScript</a>
                </li>
                <li>
                  <a href="http">HTTP API</a>
                </li>
                <li>
                  <a href="ios">iOS</a>
                </li>
                <li>
                  <a href="ruby">Ruby</a>
                </li>
                <li>
                  <a href="php">PHP</a>
                </li>
                <li>
                  <a href="net">.NET</a>
                </li>
                <li>
                  <a href="java">Java</a>
                </li>
                <li>
                  <a href="android">Android</a>
                </li>
            </ul>
          </li>
        </ul>
        
        <ul class="nav left-nav bs-docs-sidenav">
              <li>
                <a href="#getting-started">Getting Started</a>
                
              </li>    
              <li>
                <a href="#installing-the-sdk">Installing the SDK</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#cdn">CDN</a>
                        
                      </li>    
                      <li>
                        <a href="#npm">NPM</a>
                        
                      </li>    
                      <li>
                        <a href="#bower">Bower</a>
                        
                      </li>    
                  </ul>
              </li>    
              <li>
                <a href="#creating-the-client">Creating the client</a>
                
              </li>    
              <li>
                <a href="#pushing-events">Pushing events</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#single-event">Single event</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#responses">Responses</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#multiple-events">Multiple events</a>
                        
                      </li>    
                      <li>
                        <a href="#batches-of-events">Batches of events</a>
                        
                      </li>    
                      <li>
                        <a href="#bulk-importing-events">Bulk importing events</a>
                        
                      </li>    
                      <li>
                        <a href="#restrictions-on-pushing">Restrictions on pushing</a>
                        
                      </li>    
                      <li>
                        <a href="#reliability-of-events">Reliability of events</a>
                        
                      </li>    
                      <li>
                        <a href="#timestamps">Timestamps</a>
                        
                      </li>    
                  </ul>
              </li>    
              <li>
                <a href="#querying-events">Querying events</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#metadata">Metadata</a>
                        
                      </li>    
                      <li>
                        <a href="#aggregations">Aggregations</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#limitations">Limitations</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#filters">Filters</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#exists-filter">Exists filter</a>
                              </li>    
                              <li>
                                <a href="#in-filter">In filter</a>
                              </li>    
                              <li>
                                <a href="#combining-filter-expressions">Combining filter expressions</a>
                              </li>    
                              <li>
                                <a href="#-or-filters">&quot;Or&quot; filters</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#timeframes">Timeframes</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#relative-timeframes">Relative timeframes</a>
                              </li>    
                              <li>
                                <a href="#absolute-timeframes">Absolute timeframes</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#group-by">Group by</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#grouping-by-multiple-properties">Grouping by multiple properties</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#time-intervals">Time intervals</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#time-interval-with-group-by">Time interval with group by</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#timezones">Timezones</a>
                        
                      </li>    
                      <li>
                        <a href="#error-handling">Error handling</a>
                        
                      </li>    
                      <li>
                        <a href="#manipulating-results-client-side">Manipulating results client-side</a>
                        
                      </li>    
                  </ul>
              </li>    
              <li>
                <a href="#exporting-events">Exporting events</a>
                
              </li>    
              <li>
                <a href="#visualizing-data">Visualizing data</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#creating-visualizations">Creating visualizations</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#query">Query</a>
                              </li>    
                              <li>
                                <a href="#viz-type">Viz type</a>
                              </li>    
                              <li>
                                <a href="#container">Container</a>
                              </li>    
                              <li>
                                <a href="#options">Options</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#basic-visualizations">Basic visualizations</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#table-viz">Table viz</a>
                              </li>    
                              <li>
                                <a href="#text-viz">Text viz</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#chart-visualizations">Chart visualizations</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#bar-chart">Bar chart</a>
                              </li>    
                              <li>
                                <a href="#line-charts">Line charts</a>
                              </li>    
                              <li>
                                <a href="#chart-options">Chart options</a>
                              </li>    
                              <li>
                                <a href="#chart-colors">Chart colors</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#gauge-visualization">Gauge visualization</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#gauge-options">Gauge options</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#field-options">Field options</a>
                        
                      </li>    
                      <li>
                        <a href="#formatters">Formatters</a>
                        
                      </li>    
                      <li>
                        <a href="#interval-options">Interval options</a>
                        
                      </li>    
                      <li>
                        <a href="#visualization-lifecycle">Visualization lifecycle</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#refreshing-visualizations">Refreshing visualizations</a>
                              </li>    
                              <li>
                                <a href="#updating-visualizations">Updating visualizations</a>
                              </li>    
                              <li>
                                <a href="#destroying-visualizations">Destroying visualizations</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#custom-visualizations">Custom visualizations</a>
                        
                      </li>    
                  </ul>
              </li>    
              <li>
                <a href="#deleting-collections">Deleting collections</a>
                
              </li>    
              <li>
                <a href="#projects-and-keys">Projects and keys</a>
                
              </li>    
              <li>
                <a href="#security">Security</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#api-keys">API Keys</a>
                        
                      </li>    
                      <li>
                        <a href="#keeping-api-keys-secure">Keeping API Keys Secure</a>
                        
                      </li>    
                      <li>
                        <a href="#pushing-events-securely">Pushing events securely</a>
                        
                      </li>    
                      <li>
                        <a href="#querying-events-securely">Querying events securely</a>
                        
                      </li>    
                      <li>
                        <a href="#resetting-the-master-key">Resetting the master key</a>
                        
                      </li>    
                      <li>
                        <a href="#filtered-keys">Filtered keys</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#generating-a-filtered-key">Generating a filtered key</a>
                              </li>    
                          </ul>
                      </li>    
                  </ul>
              </li>    
              <li>
                <a href="#modeling-your-events">Modeling your events</a>
                
                  <ul class="nav">
                      <li>
                        <a href="#what-is-an-event-">What is an event?</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#action">Action</a>
                              </li>    
                              <li>
                                <a href="#time">Time</a>
                              </li>    
                              <li>
                                <a href="#state">State</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#collections">Collections</a>
                        
                      </li>    
                      <li>
                        <a href="#structuring-your-events">Structuring your events</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#events-are-denormalized">Events are denormalized</a>
                              </li>    
                              <li>
                                <a href="#events-are-immutable">Events are immutable</a>
                              </li>    
                              <li>
                                <a href="#events-are-rich-and-nested">Events are rich and nested</a>
                              </li>    
                              <li>
                                <a href="#events-are-schemaless">Events are schemaless</a>
                              </li>    
                          </ul>
                      </li>    
                      <li>
                        <a href="#restrictions">Restrictions</a>
                        
                          <ul class="nav">
                              <li>
                                <a href="#property-names">Property names</a>
                              </li>    
                              <li>
                                <a href="#arrays">Arrays</a>
                              </li>    
                              <li>
                                <a href="#distinct-count">Distinct count</a>
                              </li>    
                          </ul>
                      </li>    
                  </ul>
              </li>    
          </ul>
        </nav>
    </div>
    <div class="col-sm-9">
      <h1 id="getting-started">Getting Started</h1>
<p>The following guide will help you to get started using Connect.  Once you have your <a href="#projects-and-keys">project ID and API key</a> and
you have decided how to <a href="#modeling-your-events">model your events</a>, you can start <a href="#pushing-events">pushing events</a> and <a href="#querying-events">executing queries</a>.</p>
<h1 id="installing-the-sdk">Installing the SDK</h1>
<p>The JavaScript SDK can be installed in a number of different ways, depending on your environment and use case.</p>
<h2 id="cdn">CDN</h2>
<p>You can easily reference the SDK for browser apps by including it from our CDN.  Simple copy and paste the 
following script into your page:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample1" role="tab" data-toggle="tab" data-lang="html">Not Found</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample1"><pre><code class="lang-html">&lt;script src=&quot;https://cdn.getconnect.io/connect-js/{x.x.x}/standalone/connect-all.min.js&quot;&gt;&lt;/script&gt;
</code></pre></div></div></div>
<p>To take advantage of the visualizations provided, you must also reference the CSS (this is not required if you
simply wish to push events using the SDK):</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample2" role="tab" data-toggle="tab" data-lang="html">Not Found</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample2"><pre><code class="lang-html">&lt;link href=&quot;https://cdn.getconnect.io/connect-js/{x.x.x}/standalone/connect-all.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
</code></pre></div></div></div>
<p>For more info on visualization, see <a href="#visualizing-data">visualizing data</a>.</p>
<h2 id="npm">NPM</h2>
<p>If you are writing a Node.js app, or using NPM packages in the browser with something like <a href="http://browserify.org">Browserify</a>,
you can install the package from NPM:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample3" role="tab" data-toggle="tab" data-lang="bash">cURL</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample3"><pre><code class="lang-bash">npm install connect-js
</code></pre></div></div></div>
<p>You would then <code>require</code> the SDK as follows:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample4" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample4"><pre><code class="lang-js">var Connect = require(&apos;connect-js&apos;);
</code></pre></div></div></div>
<p>For browser apps, you can also install the visualization package:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample5" role="tab" data-toggle="tab" data-lang="bash">cURL</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample5"><pre><code class="lang-bash">npm install connect-js-viz
</code></pre></div></div></div>
<p>When using the visualization, you only need to <code>require</code> the viz package and all other functionality is included:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample6" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample6"><pre><code class="lang-js">var Connect = require(&apos;connect-js-viz&apos;);
</code></pre></div></div></div>
<p>For more info on visualization, see <a href="#visualizing-data">visualizing data</a>.</p>
<h2 id="bower">Bower</h2>
<p>You can easily install the SDK from Bower:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample7" role="tab" data-toggle="tab" data-lang="bash">cURL</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample7"><pre><code class="lang-bash">bower install connect-js
</code></pre></div></div></div>
<h1 id="creating-the-client">Creating the client</h1>
<p>Before you can start <a href="#pushing-events">pushing events</a>, <a href="#querying">executing queries</a> or <a href="#visualizing-data">visualizing data</a>,
you must create a Connect client with your <a href="#projects-and-keys">project ID and API key</a>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample8" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample8"><pre><code class="lang-js">var connect = new Connect({
    projectId: &apos;YOUR_PROJECT_ID&apos;,
    apiKey: &apos;YOUR_API_KEY&apos;
});
</code></pre></div></div></div>
<p>Each client is specific to a particular project - if you wish to push to or query multiple projects, simply create multiple clients.</p>
<h1 id="pushing-events">Pushing events</h1>
<p>Once you have created a client, you can start pushing events easily.</p>
<h2 id="single-event">Single event</h2>
<p>To push a single event into a collection simply call the push function on the Connect object and pass in the collection name and the event itself.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample9" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample9"><pre><code class="lang-js">connect.push(&apos;purchases&apos;, {
    name: &apos;Phone&apos;, 
    price: 465.55
})
.then(function () {
    // Handle the response

})
.catch(function (error) {
    // Handle the error

});
</code></pre></div></div></div>
<h3 id="responses">Responses</h3>
<p><strong>200 OK</strong></p>
<p>The event has been successfully recorded.</p>
<p><strong>422 Unprocessable Entity</strong></p>
<p>One or more errors have occurred with the event data sent.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample10" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample10"><pre><code class="lang-json">{
    &quot;errors&quot;: [
        { &quot;field&quot;: &quot;fieldName&quot;, &quot;description&quot;: &quot;There was an error with this field.&quot; }
    ]
}
</code></pre></div></div></div>
<p><strong>500 Internal server Error</strong></p>
<p>A server error occurred with the Connect API.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample11" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample11"><pre><code class="lang-json">{
    &quot;errorMessage&quot;: &quot;An error occurred while processing your request&quot;
}
</code></pre></div></div></div>
<p><strong>400 Bad Request</strong></p>
<p>The event data supplied is not valid.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample12" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample12"><pre><code class="lang-json">{
    &quot;errorMessage&quot;: &quot;Property names starting with tp_ are reserved and cannot be set.&quot;
}
</code></pre></div></div></div>
<h2 id="multiple-events">Multiple events</h2>
<p>To push two or more events into a single collection call the push function on the Connect object and pass in the collection name and an array of the events.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample13" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample13"><pre><code class="lang-js">connect.push(&apos;purchases&apos;, [
    {
        name: &apos;Phone&apos;, 
        price: 465.55
    },
    {
        name: &apos;Case&apos;, 
        price: 5.55
    }
])
.then(function (response) {
    // Handle the response

})
.catch(function (error) {
    // Handle the error

});
</code></pre></div></div></div>
<p>A possible response to the above example could be:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample14" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample14"><pre><code class="lang-json">{
    &quot;purchases&quot;: [
        {
            &quot;success&quot;: true
        },
        {
            &quot;success&quot;: false,
            &quot;message&quot;: &quot;An error occured inserting the event please try again.&quot;
        }
    ]
}
</code></pre></div></div></div>
<h2 id="batches-of-events">Batches of events</h2>
<p>You can also push multiple events to multiple collections in a single call by passing an object with arrays of events keyed by collection name.</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample15" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample15"><pre><code class="lang-js">connect.push({
    &quot;purchases&quot;: [
        {
            &quot;customer&quot;: {
                &quot;firstName&quot;: &quot;Tom&quot;,
                &quot;lastName&quot;: &quot;Smith&quot;
            },
            &quot;id&quot;: &quot;1849506679&quot;,
            &quot;product&quot;: &quot;12 red roses&quot;,
            &quot;purchasePrice&quot;: 34.95
        },
        {
            &quot;customer&quot;: {
                &quot;firstName&quot;: &quot;Jane&quot;,
                &quot;lastName&quot;: &quot;Doe&quot;
            },
            &quot;id&quot;: &quot;123456&quot;,
            &quot;product&quot;: &quot;1 daisy&quot;,
            &quot;purchasePrice&quot;: 8.95
        }
    ],
    &quot;refunds&quot;: [
        {
            &quot;customer&quot;: {
                &quot;firstName&quot;: &quot;Tom&quot;,
                &quot;lastName&quot;: &quot;Smith&quot;
            },
            &quot;id&quot;: &quot;REF-1234&quot;,
            &quot;product&quot;: &quot;12 red roses&quot;,
            &quot;purchasePrice&quot;: -34.95
        }
    ]
})
.then(function (response) {
    // Handle the response

})
.catch(function (error) {
    // Handle the error

});
</code></pre></div></div></div>
<p>A possible response to the above example could be:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample16" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample16"><pre><code class="lang-json">{
    &quot;purchases&quot;: [
        {
            &quot;success&quot;: true
        },
        {
            &quot;success&quot;: false,
            &quot;message&quot;: &quot;An error occured inserting the event please try again.&quot;
        }
    ],
    &quot;refunds&quot;: [
        {
            &quot;success&quot;: true
        }
    ]
}
</code></pre></div></div></div>
<h2 id="bulk-importing-events">Bulk importing events</h2>
<p>Currently, this SDK does not support bulk importing events.</p>
<p>However, you can use the <a href="http#bulk-importing-events">HTTP API</a> to run bulk imports if you need.</p>
<h2 id="restrictions-on-pushing">Restrictions on pushing</h2>
<p>There are a number of restrictions on the properties you can use in your events and the
limitations on querying which influences how you should structure your events.</p>
<p>Refer to <a href="#restrictions">restrictions</a> in the <a href="#modeling-your-events">modeling your events</a> section.</p>
<h2 id="reliability-of-events">Reliability of events</h2>
<p>Currently, it is not possible to persist/queue events for delivery in the JavaScript SDK.  Pushing events performs a simple,
asynchronous operation to push the event.</p>
<p>In a browser, this means you cannot guarantee the delivery of events successfully.</p>
<p>In a Node.js app, you may want to consider create queues for your events to ensure they are delivered reliably.</p>
<p>Events also allow a custom ID to be sent in the event document which will prevent duplicates (i.e. guarantees idempotence even if the event is delivered multiple times). For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample17" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample17"><pre><code class="lang-json">{
    &quot;customer&quot;: {
        &quot;firstName&quot;: &quot;Tom&quot;,
        &quot;lastName&quot;: &quot;Smith&quot;
    },
    &quot;id&quot;: &quot;1849506679&quot;,
    &quot;product&quot;: &quot;12 red roses&quot;,
    &quot;purchasePrice&quot;: 34.95
}
</code></pre></div></div></div>
<h2 id="timestamps">Timestamps</h2>
<p>All events have a single <code>timestamp</code> property which records when the event being pushed occurred.  Events cannot
have more than one date/time property.  If you feel you need more than one date/time property, you probably need
to reconsider how you&apos;re <a href="#modeling-your-events">modeling your events</a>.</p>
<blockquote>
<p><strong>Querying</strong></p>
<p>You can only run time interval queries or timeframe filters on the <code>timestamp</code> property.  No other date/time property
in an event is supported for querying.</p>
</blockquote>
<p>By default, if no <code>timestamp</code> property is sent with the event, Connect will use the current date and time as
the timestamp of the event.</p>
<p>The timestamp, however, can be overridden to, for example, accommodate historical events or maintain accuracy
of event times when events are queued.</p>
<p>The timestamp must be supplied as an ISO-8601 formatted date.  The date must be in UTC (you cannot specify a timezone offset).
For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample18" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample18"><pre><code class="lang-json">{
    &quot;customer&quot;: {
        &quot;firstName&quot;: &quot;Tom&quot;,
        &quot;lastName&quot;: &quot;Smith&quot;
    },
    &quot;timestamp&quot;: &quot;2015-02-05T14:55:56.587Z&quot;,
    &quot;product&quot;: &quot;12 red roses&quot;,
    &quot;purchasePrice&quot;: 34.95
}
</code></pre></div></div></div>
<blockquote>
<p><strong>Timezones</strong></p>
<p>Timestamps are always recorded in UTC.  If you supply a timestamp in a timezone other than UTC, it will
be converted to UTC.  When you query your events, you can specify a timezone so things like time intervals
will be returned in local time.</p>
</blockquote>
<h1 id="querying-events">Querying events</h1>
<p>Using the SDK, you can construct and execute queries client-side and receive a promise to the results.</p>
<p>Once you have <a href="#creating-the-client">created a client</a> with a valid <a href="#projects-and-keys">read key</a>, you can start querying
your collections immediately. </p>
<p>For example, to get the sum of the <code>price</code> property in a collection called <code>purchases</code>, you would execute the following query:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample19" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample19"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({ &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; } })
    .execute()
    .then(function(result) {
        // Handle the result
    }, function(error) {
      // Handle an error
    });
</code></pre></div></div></div>
<h2 id="metadata">Metadata</h2>
<p>The query results return metadata on the executed query.  This includes any <a href="#group-by">groups</a> used, the <a href="#time-intervals">time interval</a>, if specified,
and the <a href="#timezones">timezone</a>, if specified, for the query.</p>
<p>For example, if you grouped by <code>product</code>, with a <strong>daily</strong> time interval and a timezone of <strong>Australia/Brisbane</strong>, the metadata would look like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample20" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample20"><pre><code class="lang-json">{
    &quot;groups&quot;: [&quot;product&quot;],
    &quot;interval&quot;: &quot;daily&quot;,
    &quot;timezone&quot;: &quot;Australia/Brisbane&quot;
}
</code></pre></div></div></div>
<p>Metadata is used by our Visualization SDK to discover the shape of your query so that we can easily display the results.  If you&apos;re doing your own visualization,
you can take advantage of the metadata as hints on how to render the results.</p>
<h2 id="aggregations">Aggregations</h2>
<p>You can perform various aggregations over events you have pushed.  Simply specify in the query&apos;s select which
properties you wish to aggregate and which aggregation you wish to use.  You also must specify an &quot;alias&quot; for the
result set that is returned.</p>
<p>For example, to query the <code>purchases</code> collection and perform aggregations on the <code>price</code> event property::</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample22" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample22"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;itemsSold&quot;: &quot;count&quot;,
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; },
        &quot;averagePrice&quot;: { &quot;avg&quot;: &quot;price&quot; },
        &quot;minPrice&quot;: { &quot;min&quot;: &quot;price&quot; },
        &quot;maxPrice&quot;: { &quot;max&quot;: &quot;price&quot; }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>This would return a result like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample24" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample24"><pre><code class="lang-json">{
    &quot;metadata&quot;: {
        &quot;groups&quot;: [],
        &quot;interval&quot;: null,
        &quot;timezone&quot;: null
    },
    {
        &quot;itemsSold&quot;: 25,
        &quot;totalPrice&quot;: 5493.25,
        &quot;averagePrice&quot;: 219.73,
        &quot;minPrice&quot;: 5.49,
        &quot;maxPrice&quot;: 589.20
    }
}
</code></pre></div></div></div>

<p>The following aggregations are supported:</p>
<ul>
<li>count</li>
<li>sum</li>
<li>avg</li>
<li>min</li>
<li>max</li>
</ul>
<h3 id="limitations">Limitations</h3>
<ul>
<li>Aggregations only work on numeric properties.  If you try to aggregate a string property, you will receive a null result.
If you try to aggregate a property with multiple types (e.g. some strings, some numbers), only the numeric values will be
added - the rest are ignored.</li>
</ul>
<h2 id="filters">Filters</h2>
<p>You can filter the events you wish to include in your queries by specifying one or more filters.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample27" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample27"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;product&quot;: &quot;12 red roses&quot;
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>The above will filter the query results for only those events that have a <code>product</code> property equalling &quot;12 red roses&quot;.
The above is also shorthand for the <strong>eq</strong> operator. To illustrate this, the following is identical to the above:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample30" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample30"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;product&quot;: { &quot;eq&quot;: &quot;12 red roses&quot; }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>The following match operators are currently supported:</p>
<ul>
<li>eq (equal to)</li>
<li>neq (not equal to)</li>
<li>gt (greater than)</li>
<li>gte (greater than or equal to)</li>
<li>lt (less than)</li>
<li>lte (less than or equal to)</li>
<li><a href="#exists-filter">exists (whether or not a property exists)</a></li>
<li>startsWith (starts with - string values only)</li>
<li>endsWidth (ends with - string values only)</li>
<li>contains (contains - string values only)</li>
<li><a href="#in-filter">in (property is one of a list of values)</a> </li>
</ul>
<h3 id="exists-filter">Exists filter</h3>
<p>The exists filter will filter the query results for only events that either have or don&apos;t have the specified property
and where the specified property is or isn&apos;t null respectively.  You supply a boolean value with the exists operator
to specify whether to include or exclude the events.</p>
<blockquote>
<p><strong>Missing properties vs null values</strong></p>
<p>We treat missing properties and properties with a null value the same for the purpose of the exists filter.  While we
plan to change this behavior in the future, you should consider setting a default value as opposed to a null value on
properties if you wish to make a distinction.</p>
</blockquote>
<p>For example, the following will filter for events that have a property called <code>gender</code>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample33" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample33"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;gender&quot;: { &quot;exists&quot;: true }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>Whereas the following will filter for events that <em>do not</em> have a property called <code>gender</code>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample36" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample36"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;gender&quot;: { &quot;exists&quot;: false }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<h3 id="in-filter">In filter</h3>
<p>The in filter allows you to specify a list of values for which a property should match.</p>
<p>For example, the following will filter for events that have a <code>category</code> of either &quot;Bikes&quot;, &quot;Books&quot; or &quot;Magazines&quot;:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample39" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample39"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;category&quot;: { &quot;in&quot;: [&quot;Bikes&quot;, &quot;Books&quot;, &quot;Magazines&quot;] }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>

<p><strong>Note:</strong> All values in the list must be of the same type (i.e. string, numeric or boolean).  Mixed types are currently not supported.</p>
<h3 id="combining-filter-expressions">Combining filter expressions</h3>
<p>You can also combine filter expressions to filter multiple values on the same property.</p>
<p>For example, the following will filter for events with a <code>price</code> property greater than 5 but less than 10:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample41" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample41"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .filter({
        &quot;price&quot;: { &quot;gt&quot;: 5, &quot;lt&quot;: 10 }
    })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<h3 id="-or-filters">&quot;Or&quot; filters</h3>
<p>Currently, &quot;or&quot; filters are not supported.</p>
<h2 id="timeframes">Timeframes</h2>
<p>You can restrict query results by specifying the <strong>timeframe</strong> for the query which will filter for events only within that specific timeframe.</p>
<blockquote>
<p>If no timeframe is specified, events will not be filtered by time; the query will match events from all time.</p>
</blockquote>
<p>For example, the following query filters for events only for this month:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample44" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample44"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe(&quot;this_month&quot;)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>There are two types of timeframes:</p>
<ul>
<li><strong>Relative timeframes</strong> - a timeframe relative to the current date and time.</li>
<li><strong>Absolute timeframes</strong> - a timeframe between two specific dates and times.</li>
</ul>
<h3 id="relative-timeframes">Relative timeframes</h3>
<p>Relative timeframes can be specified as either a string or a complex type containing exact numbers of &quot;periods&quot; to filter.</p>
<blockquote>
<p><strong>Timezones</strong></p>
<p>By default, all relative timeframes are <strong>UTC</strong> by default. See the <a href="#timezones">timezone section</a> to specify your own timezone.</p>
</blockquote>
<p>The following are supported string timeframes:</p>
<ul>
<li>this_minute</li>
<li>last_minute</li>
<li>this_hour</li>
<li>last_hour</li>
<li>today</li>
<li>yesterday</li>
<li>this_week</li>
<li>last_week</li>
<li>this_month</li>
<li>last_month</li>
<li>this_quarter</li>
<li>last_quarter</li>
<li>this_year</li>
<li>last_year</li>
</ul>
<p>You can also specify exactly how many current/previous periods you wish to include in the query results.</p>
<p>For example, if you want to filter by the <strong>today and the last 2 days</strong>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample47" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample47"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe({ &quot;current&quot;: { &quot;days&quot;: 3 } })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>

<p>Or, to filter by the <strong>last 2 months, excluding the current month</strong>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample49" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample49"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe({ &quot;previous&quot;: { &quot;months&quot;: 2 } })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>

<p>The following periods are supported for complex, relative timeframes:</p>
<ul>
<li>minutes</li>
<li>hours</li>
<li>days</li>
<li>weeks</li>
<li>months</li>
<li>quarters</li>
<li>years</li>
</ul>
<blockquote>
<p><strong>Weeks</strong></p>
<p>Our weeks start on a Sunday and finish on a Saturday.  In the future, we plan to support specifying on which
day of the week you&apos;d like to start your weeks.</p>
</blockquote>
<h3 id="absolute-timeframes">Absolute timeframes</h3>
<p>You can specify an absolute timeframe by constructing an object with the <strong>start</strong> and <strong>end</strong> properties set to
the desired start and end times in ISO-8601 format.</p>
<p>For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample50" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample50"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe({ &quot;start&quot;: &quot;2015-02-01T00:00:00.000Z&quot;, &quot;end&quot;: &quot;2015-02-25T00:00:00.000Z&quot; })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>
<p>You can also set the <strong>start</strong> end <strong>end</strong> properties to Date objects, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample51" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample51"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe({ &quot;start&quot;: new Date(2015, 2, 1), &quot;end&quot;: new Date(2015, 2, 25) })
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>
<blockquote>
<p>You can&apos;t specify a timezone when using absolute timeframes as the timezone information comes from the ISO-8601
dates specified.  An error will occur if you try to do this.</p>
</blockquote>
<h2 id="group-by">Group by</h2>
<p>You can group the query results by one or more properties from your events.</p>
<blockquote>
<p><strong>Missing properties vs null values</strong></p>
<p>We treat missing properties and properties with a null value the same for the purpose of grouping.
This means that all events with a null value for a property or missing that property altogether will
be grouped into the &quot;null&quot; value for that query.  While we plan to change this in the future, you
should consider setting a default value as opposed to a null value on properties if you wish to make
a distinction.</p>
</blockquote>
<p>For example, to query total sales by country:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample53" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample53"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .groupBy(&quot;country&quot;)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>This would return a result like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample55" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample55"><pre><code class="lang-json">{
    &quot;metadata&quot;: {
        &quot;groups&quot;: [&quot;country&quot;],
        &quot;interval&quot;: null,
        &quot;timezone&quot;: null
    },
    &quot;results&quot;: [{
        &quot;country&quot;: &quot;Australia&quot;,
        &quot;totalPrice&quot;: 1000000
    },
    {
        &quot;country&quot;: &quot;Italy&quot;,
        &quot;totalPrice&quot;: 2500000
    },
    {
        &quot;country&quot;: &quot;United States&quot;,
        &quot;totalPrice&quot;: 10000000
    }]
}
</code></pre></div></div></div>

<h3 id="grouping-by-multiple-properties">Grouping by multiple properties</h3>
<p>You can also group by multiple properties in your events by providing multiple property names.</p>
<p>For example, to query total sales by country and product category:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample58" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample58"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .groupBy([&quot;country&quot;, &quot;product.category&quot;])
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>This would return a result like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample60" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample60"><pre><code class="lang-json">{
    &quot;metadata&quot;: {
        &quot;groups&quot;: [&quot;country&quot;, &quot;product.category&quot;],
        &quot;interval&quot;: null,
        &quot;timezone&quot;: null
    },
    &quot;results&quot;: [{
        &quot;country&quot;: &quot;Australia&quot;,
        &quot;product.category&quot;: &quot;Bikes&quot;,
        &quot;totalPrice&quot;: 500000
    },
    {
        &quot;country&quot;: &quot;Australia&quot;,
        &quot;product.category&quot;: &quot;Cars&quot;,
        &quot;totalPrice&quot;: 500000
    },
    {
        &quot;country&quot;: &quot;Italy&quot;,
        &quot;product.category&quot;: &quot;Scooters&quot;,
        &quot;totalPrice&quot;: 2500000
    },
    {
        &quot;country&quot;: &quot;United States&quot;,
        &quot;product.category&quot;: &quot;Mobile Phones&quot;,
        &quot;totalPrice&quot;: 8000000
    },
    {
        &quot;country&quot;: &quot;United States&quot;,
        &quot;product.category&quot;: &quot;Laptops&quot;,
        &quot;totalPrice&quot;: 2000000
    }] 
}
</code></pre></div></div></div>

<h2 id="time-intervals">Time intervals</h2>
<p>Time intervals allow you to group results by a time period, so that you could analyze your events over time.</p>
<p>For example, to query daily total sales this month:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample63" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample63"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe(&quot;this_month&quot;)
    .interval(&quot;daily&quot;)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>This would return a result like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample65" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample65"><pre><code class="lang-json">{
    &quot;metadata&quot;: {
        &quot;groups&quot;: [],
        &quot;interval&quot;: &quot;daily&quot;,
        &quot;timezone&quot;: null
    },
    &quot;results&quot;: [{
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-01T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-02T00:00:00Z&quot; },
        &quot;results&quot;: [{
            &quot;totalPrice&quot;: 500000
        }]
    },
    {
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-02T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-03T00:00:00Z&quot; },
        &quot;results&quot;: [{
            &quot;totalPrice&quot;: 150000
        }]
    },
    {
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-03T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-04T00:00:00Z&quot; },
        &quot;results&quot;: [{
            &quot;totalPrice&quot;: 25000
        }]
    }]
}
</code></pre></div></div></div>

<p>The following time intervals are supported:</p>
<ul>
<li>minutely</li>
<li>hourly</li>
<li>daily</li>
<li>weekly</li>
<li>monthly</li>
<li>quarterly</li>
<li>yearly</li>
</ul>
<h3 id="time-interval-with-group-by">Time interval with group by</h3>
<p>You can also combine a time interval with a group by in your query.</p>
<p>For example, to query daily total sales this month by country:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample68" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample68"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timeframe(&quot;this_month&quot;)
    .interval(&quot;daily&quot;)
    .groupBy(&quot;country&quot;)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>This would return a result like:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample70" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample70"><pre><code class="lang-json">{
    &quot;metadata&quot;: {
        &quot;groups&quot;: [&quot;country&quot;],
        &quot;interval&quot;: &quot;daily&quot;,
        &quot;timezone&quot;: null
    },
    &quot;results&quot;: [{
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-01T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-02T00:00:00Z&quot; },
        &quot;results&quot;: [
            {
                &quot;country&quot;: &quot;Australia&quot;,
                &quot;totalPrice&quot;: 100000
            },
            {
                &quot;country&quot;: &quot;Italy&quot;,
                &quot;totalPrice&quot;: 100000
            },
            {
                &quot;country&quot;: &quot;United States&quot;,
                &quot;totalPrice&quot;: 300000
            }
        ]
    },
    {
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-02T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-03T00:00:00Z&quot; },
        &quot;results&quot;: [
            {
                &quot;country&quot;: &quot;Australia&quot;,
                &quot;totalPrice&quot;: 25000
            },
            {
                &quot;country&quot;: &quot;Italy&quot;,
                &quot;totalPrice&quot;: 25000
            },
            {
                &quot;country&quot;: &quot;United States&quot;,
                &quot;totalPrice&quot;: 100000
            }
        ]
    },
    {
        &quot;interval&quot;: { &quot;start&quot;: &quot;2015-02-03T00:00:00Z&quot;, &quot;end&quot;: &quot;2015-02-04T00:00:00Z&quot; },
        &quot;results&quot;: [
            {
                &quot;country&quot;: &quot;Australia&quot;,
                &quot;totalPrice&quot;: 5000
            },
            {
                &quot;country&quot;: &quot;Italy&quot;,
                &quot;totalPrice&quot;: 5000
            },
            {
                &quot;country&quot;: &quot;United States&quot;,
                &quot;totalPrice&quot;: 15000
            }
        ]
    }]
}
</code></pre></div></div></div>

<h2 id="timezones">Timezones</h2>
<p>By default, Connect uses <strong>UTC</strong> as the timezone for queries with relative timeframes or time intervals.
You can override this to be the timezone of your choice by specifying the <strong>timezone</strong> in your query.</p>
<blockquote>
<p>You can only specify a timezone when you have specified a <a href="#time-intervals">time interval</a> or a
<a href="#relative-timeframes">relative timeframe</a>.  If you try to specify a timezone without one of these
set, an error will be returned.</p>
</blockquote>
<p>You can specify a numeric (decimal) value for an hours offset of UTC, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample73" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample73"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timezone(10)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<p>You can also specify a string which contains an <a href="http://www.iana.org/time-zones">IANA time zone identifier</a>, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample76" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample76"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .timezone(&quot;Australia/Brisbane&quot;)
    .execute()
    .then(function(result) {
        // Handle the result
    });
</code></pre></div></div></div>


<h2 id="error-handling">Error handling</h2>
<p>Executing a query (via the <code>execute()</code> function) returns a promise (we use <a href="https://github.com/kriskowal/q">Q</a> for our promises).</p>
<p>This means you should handle the failure of that promise if you wish to catch any errors.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample78" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample78"><pre><code class="lang-js">connect.query(&quot;purchases&quot;)
    .select({
        &quot;itemsSold&quot;: &quot;count&quot;,
        &quot;totalPrice&quot;: { &quot;sum&quot;: &quot;price&quot; }
    })
    .execute()
    .then(function(result) {
        // Handle the successful result

    })
    .catch(function(err) {
        // Handle the error

        console.log(&quot;HTTP status: &quot; + err.status);
    });
</code></pre></div></div></div>
<p>The following error responses may be returned from the API:</p>
<p><strong>422 Unprocessable Entity</strong></p>
<p>The query was not in the correct format.  The message body will contain a list of errors, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample79" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample79"><pre><code class="lang-json">{
    &quot;errors&quot;: [
        {
            &quot;field&quot;: &quot;query&quot;,
            &quot;description&quot;: &quot;The query JSON supplied is not valid.&quot;
        }
    ]
}
</code></pre></div></div></div>
<p><strong>413 Too Many Results</strong></p>
<p>Queries result sets are limited to 10,000 results.  If you exceed this threshold, you will receive this error.</p>
<p>Ideally, queries should return a small number of results, even if they are aggregating a large number of events.
You should reconsider the way in which you are querying if you are hitting this limit.</p>
<p><strong>500 Internal Server Error</strong></p>
<p>An internal server error occurred in the Connect API. </p>
<h2 id="manipulating-results-client-side">Manipulating results client-side</h2>
<p>You can manipulate the result set client-side after executing one or more queries to perform calculations
or join multiple queries together.</p>
<p>By chaining promises together, you can maintain a single promise which returns the desired result set, which
will easily plug into the <a href="#visualizing-data">visualization library</a>.</p>
<p><strong>Note:</strong> Before you modify a result set, it is important to clone the result set first to ensure other forks
of the original promise are not modified.  The SDK provides a simple clone function to assist with this. </p>
<p>For example, perhaps you want to calculate the gross profit of your sales:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample80" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample80"><pre><code class="lang-js">var resultsPromise = connect.query(&quot;purchases&quot;)
    .select({
        totalSales: { &quot;sum&quot;: &quot;price&quot; },
        totalCost: { &quot;sum&quot;: &quot;cost&quot; }
    })
    .timezone(&apos;Australia/Brisbane&apos;)
    .execute();
    .then(function (results) {
        var newResults = results.clone();

        for (var i = 0; i &lt; newResults.results.length; i++)
            newResults.results[i].grossProft = newResults.results[i].totalSales - newResults.results[i].totalCost;

        return results;
    });
</code></pre></div></div></div>
<p>Your <code>resultsPromise</code> can now be passed to the <a href="#visualizing-data">visualization library</a> and will be treated
as if it is a standard query.</p>
<p>In fact, promises are entirely loosely-coupled to queries - you can construct your own promise that returns a valid
result set with <code>metadata</code> and <code>results</code>.</p>
<p>This means you can combine multiple queries, augment results with data from other services or perform complex
calculations client-side. </p>
<h1 id="exporting-events">Exporting events</h1>
<p>Currently, this SDK does not support exporting events.</p>
<p>However, you can use <a href="http#exporting-events">HTTP API</a> to perform exports as required.</p>
<h1 id="visualizing-data">Visualizing data</h1>
<p>To start visualizing data with our visualizations, you must ensure you have first included the viz library.</p>
<p>If you are <a href="#cdn">using the CDN</a> or <a href="#bower">Bower</a>, make sure you&apos;ve referenced the library and CSS file.</p>
<p>For <a href="#npm">NPM</a>, make sure you&apos;ve installed the <code>connect-js-viz</code> package and referenced the library and the CSS
(via Browserify or through other means).</p>
<p>Once this is correctly installed, you can start creating visualizations, for example:</p>
<p data-height="300" data-theme-id="17963" data-slug-hash="WvBGEO" data-default-tab="results" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/WvBGEO/">Connect Text viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<h2 id="creating-visualizations">Creating visualizations</h2>
<p>To create a viz, you must provide:</p>
<ul>
<li>a <a href="#query">query</a> to visualize.</li>
<li>a <a href="#viz-type">viz type</a>.</li>
<li>a HTML <a href="#container">container</a> that the visualization will be appended to.</li>
</ul>
<p>You may also supply:</p>
<ul>
<li><a href="#options">options</a> to configure the behavior and appearance of the visualization.</li>
</ul>
<p>To create a new visualization you call the <code>visualize(query)</code> method on either <code>Connect</code> itself or an instance of <code>Connect</code>.</p>
<p>For example, to <a href="#chart-visualizations">visualize a chart</a>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample81" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample81"><pre><code class="lang-js">
var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;)
    .interval(&apos;monthly&apos;);

var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .draw();
</code></pre></div></div></div>
<p>By using the <a href="#metadata">metadata</a> from the result set, visualizations <strong>automatically</strong> map the query results to various elements.
For example, <a href="#chart-visualizations">chart visualizations</a> will automatically decide how to map <a href="#group-by">groups</a>,
<a href="#time-intervals">time series</a> and <a href="#aggregations">aggregations</a> to its axes or series. </p>
<p>Note. You should also be mindful of the <a href="#viz-lifecycle">viz lifecycle</a> so you can <a href="#refreshing-visualizations">refresh</a>,
<a href="#updating-visualizations">update</a> or <a href="#destroying-visualizations">destroy</a> visualizations as required.</p>
<h3 id="query">Query</h3>
<p>When creating a visualization builder with the <code>visualize(query)</code> method you can specify either a <a href="#querying-events">query</a> generated by <code>connect.query</code> or a <strong>function</strong> that returns a promise
(of a valid result set).</p>
<p>Specifying a <strong>function</strong> that returns a promise can be useful if you want to
<a href="#manipulating-results-client-side">chain promises and run your own custom calculations</a> on the result set or combine it
with other services&apos; data.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample82" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample82"><pre><code class="lang-js">var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;)
    .interval(&apos;monthly&apos;);

var resultsFactory = function() {
  return query.execute()
    .then(function (results) {
        var newResults = results.clone();
        // modify the new results
        return newResults;
    });
}

var chart = Connect.visualize(resultsFactory)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .with({
        title: &apos;Total Sales by Product Monthly&apos;
    })
    .draw();
</code></pre></div></div></div>
<h3 id="viz-type">Viz type</h3>
<p>You specify the viz type by calling the <code>as(vizType)</code> method on the visualization builder.</p>
<p>You need to provide the name of the viz type you want to use as a <strong>string</strong>.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td>chart</td>
<td><a href="#chart-visualizations">Bar charts, Line charts etc.</a></td>
</tr>
<tr>
<td>text</td>
<td><a href="#text-viz">Text</a></td>
</tr>
<tr>
<td>table</td>
<td><a href="#table-viz">Table</a></td>
</tr>
<tr>
<td>guage</td>
<td><a href="#gauge-visualization">Gauge</a></td>
</tr>
</tbody>
</table>
<p>The viz type can also be the name of any registered <a href="#custom-visualizations">custom visualizations.</a></p>
<h3 id="container">Container</h3>
<p>You specify the container by calling the <code>inside(container)</code> method on the visualization builder.</p>
<p>The container can either be a reference to a <strong>HTMLElement</strong> or the id of the HTML element as a <strong>string</strong>.</p>
<p>Your HTML element you provide as a container <strong>must</strong> have an explicit height for the visualization to display correctly.</p>
<h3 id="options">Options</h3>
<p>You specify the options by calling the <code>with(options)</code> method on the visualization builder.</p>
<p>The options for a viz contains <a href="#field-options">field options</a>, <a href="#interval-options">interval options</a> (if applicable)
and any specific options related to the viz type.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample83" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample83"><pre><code class="lang-js">{
    fields: { /* field options */ },
    intervals: { /* interval options */ },
    chart: { /* chart specific options */ },
    gauge: { /* gauge specific topions */ }
}
</code></pre></div></div></div>
<h2 id="basic-visualizations">Basic visualizations</h2>
<p>Connect offers a range of pre-built basic visualizations which you can use to visualize data.  You can also <a href="#custom-visualizations">build your own</a>.</p>
<p>All visualizations support the setting of <a href="#field-options">field options</a> and <a href="#interval-options">interval options</a> (if applicable).</p>
<h3 id="table-viz">Table viz</h3>
<p data-height="320" data-theme-id="17963" data-slug-hash="XbwjVx" data-default-tab="results" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/XbwjVx/">Connect Table viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>The table viz will display your results in a tabular fashion.  This is best used with <a href="#group-by">grouped</a> or <a href="#time-intervals">time interval</a> queries,
which get displayed as multiple rows. </p>
<p>You can also apply the following CSS classes to your viz&apos;s container to change the styling and/or behavior of the table:</p>
<ul>
<li><code>connect-table-fixed-header</code> - enable scrolling of the table and ensure that the header remains fixed (using pure CSS).</li>
<li><code>connect-table-striped</code> - enable &quot;zebra striped&quot; styling of the table.</li>
<li><code>connect-table-hover</code> - changes a row&apos;s background color when hovering over it.</li>
<li><code>connect-table-solid-header</code> - display the table header with a solid background color.</li>
</ul>
<p>The actual styling/colors used can be overridden using CSS, or you can <a href="#less-variables">specify custom LESS variables</a> and build the SDK yourself.</p>
<h3 id="text-viz">Text viz</h3>
<p data-height="300" data-theme-id="17963" data-slug-hash="WvBGEO" data-default-tab="results" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/WvBGEO/">Connect Text viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>The text viz will display a single result in simple text.  You can add a title and specify the format via the <a href="#chart-options">options</a>.</p>
<p>You cannot create a text viz for queries with <a href="#group-by">groups</a> or <a href="#time-intervals">time intervals</a> - doing so will display an &quot;unsupported query&quot;
error on the visualization.</p>
<h2 id="chart-visualizations">Chart visualizations</h2>
<p>Connect offers a range of pre-built chart visualizations which you can use to visualize data.  You can also <a href="#custom-visualizations">build your own</a>.</p>
<p>See <a href="#chart-options">chart options</a> for information on how to customize these charts.  All visualizations also support the setting of
<a href="#field-options">field options</a> and <a href="#interval-options">interval options</a> (if applicable).</p>
<h3 id="bar-chart">Bar chart</h3>
<p data-height="300" data-theme-id="17963" data-slug-hash="PqvORv" data-default-tab="results" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/PqvORv/">Connect Bar Chart viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>You can generate a bar chart for queries by specifying <code>type: &apos;bar&apos;</code> on the options for a chart visualization.</p>
<p>Bar charts are great for showing discrete data, such as with single or multiple <a href="#group-by">grouped</a> queries.  While you can display <a href="#time-intervals">time interval</a>
queries with a bar chart, it is highly recommended to use <a href="#line-charts">line charts</a> instead.</p>
<h3 id="line-charts">Line charts</h3>
<p data-height="300" data-theme-id="17963" data-slug-hash="doBXdm" data-default-tab="result" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/doBXdm/">Connect Line Charts</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>You can generate a line chart for <a href="#group-by">grouped</a> or <a href="#time-intervals">time interval</a> queries by specifying one of the following <code>type</code> values on the options for a chart visualization:</p>
<ul>
<li><code>line</code></li>
<li><code>spline</code></li>
<li><code>area</code></li>
<li><code>area-spline</code></li>
<li><code>step</code></li>
<li><code>area-step</code></li>
</ul>
<p>In the above example, all area charts specify <code>stack: true</code> in the <a href="#chart-options">options</a> to provide a stacked area chart.  Also, the switch between the various chart types
makes use of the <code>destroy()</code> method to clean up (documented <a href="#destroying-visualizations">here</a>).</p>
<h3 id="chart-options">Chart options</h3>
<p>All charts allow you to specify various options to customize their appearance and behavior:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample84" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample84"><pre><code class="lang-js">var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .with({
        chart: {
            type: &apos;bar&apos;,  
            colors: [&apos;#3498db&apos;, &apos;#34495e&apos;, &apos;#e74c3c&apos;],
            showLegend: true,
            padding:{
                top: 5,
                right: 10,
                bottom: 5,
                left: 10
            },
            yAxis: {
                format: &apos;$,.2f&apos;,
                startAtZero: true,
                min: null,
                max: null
            },
            stack: true
        }
    })
    .draw();
</code></pre></div></div></div>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type</code></td>
<td><code>string</code></td>
<td>Type of chart to display (one of either <code>bar</code>, <code>line</code>, <code>area</code>, <code>spline</code>, <code>area-spline</code>, <code>step</code>, <code>area-step</code>)</td>
</tr>
<tr>
<td><code>colors</code></td>
<td><code>string[]</code> or <code>function</code></td>
<td>An array of colors to use as a palette for the chart. Or a function to provide more granular control. See <a href="#chart-colors">Chart colors</a> for more info.</td>
</tr>
<tr>
<td><code>showLegend</code></td>
<td><code>boolean</code></td>
<td>Specify whether or not to show the legend.  By default <code>true</code>, but <code>false</code> with a single aggregation and no group by/interval.</td>
</tr>
<tr>
<td><code>padding</code></td>
<td><code>object</code></td>
<td>The padding around the gauge (left, right, top and bottom).  By default, <code>{ left: 0, right: 0, bottom: 0, top: 0 }</code></td>
</tr>
<tr>
<td><code>yAxis.format</code></td>
<td><code>string</code> or <code>function</code></td>
<td>Either a format string, or alternatively a function accepting a single value argument that returns a formatted string. See <a href="#formatters">Formatters</a> for more info.</td>
</tr>
<tr>
<td><code>yAxis.startAtZero</code></td>
<td><code>boolean</code></td>
<td>Specifically for <code>area</code>, <code>area-spline</code>, <code>area-step</code> and <code>bar</code>, this specifies whether or not the Y-axis min value will default to zero, or automatically calculate based on the data.  By default, this is <code>true</code>.</td>
</tr>
<tr>
<td><code>yAxis.min</code></td>
<td><code>number</code></td>
<td>An explicit minimum value for the Y-axis (this overrides <code>startAtZero</code> in all instances).</td>
</tr>
<tr>
<td><code>yAxis.max</code></td>
<td><code>number</code></td>
<td>An explicit maximum value for the Y-axis.</td>
</tr>
<tr>
<td><code>stack</code></td>
<td><code>boolean</code></td>
<td>For all chart types except <code>bar</code>, whether or not to stack multiple series.</td>
</tr>
</tbody>
</table>
<h3 id="chart-colors">Chart colors</h3>
<p>There are multiple ways in which you can customize chart colors.  If no colors are specified in <a href="#chart-options">chart options</a>, the
<a href="https://github.com/getconnect/connect-js/blob/master/lib/viz/palette.ts">default palette</a> is used.</p>
<p>You can override the palette by setting the <code>colors</code> property on the <a href="#chart-options">chart options</a> with an array of colors. For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample85" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample85"><pre><code class="lang-js">Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#sales-area&apos;)
    .with({
        title: &apos;Electric Car Sales 2018 (Units)&apos;,
        chart: {
            type: &apos;bar&apos;,    
            colors: [&apos;#ff00000&apos;, &apos;blue&apos;, &apos;rgb(0, 255, 0)&apos;]
        }
    })
    .draw();
</code></pre></div></div></div>
<p>Furthermore, you can provide a custom function to the <code>colors</code> property allowing complete control over the coloring on the chart. For example, you may
want specific groups in your data to be the same color across multiple charts to allow users to correlate data by color:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample86" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample86"><pre><code class="lang-js">var manufacturerColors = function(context) {
    if (!context.groupBys)
        return;

    switch (context.groupBys[&apos;manufacturer&apos;]) {
        case &apos;Tesla&apos;:
            return &apos;rgb(155, 89, 182)&apos;;
        case &apos;Toyota&apos;:
            return &apos;rgb(26, 188, 156)&apos;;
        case &apos;GM&apos;:
            return &apos;rgb(231, 76, 60)&apos;;
        case &apos;Nissan&apos;:
            return &apos;rgb(243, 156, 18)&apos;;
        case &apos;Ford&apos;:
            return &apos;rgb(52, 152, 219)&apos;;
    }
};

Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#sales-bar&apos;)
    .with({
        title: &apos;Electric Car Sales 2018 (Units)&apos;,
        chart: {
            type: &apos;bar&apos;,
            colors: manufacturerColors
        }
    })
    .draw();

Connect.visualize(intervalQuery)
    .as(&apos;chart&apos;)
    .inside(&apos;#sales-area&apos;)
    .with({
        title: &apos;Electric Car Sales 2018 (Units)&apos;,
        chart: {
            type: &apos;area-spline&apos;,
            colors: manufacturerColors
        }
    })
    .draw();
</code></pre></div></div></div>
<p>The function that you provide to the <code>colors</code> property accepts a single <code>context</code> argument and should return a color as a string.
It will be called for each separate component of the chart, each time the <code>context</code> parameter will contain the unique combination of <code>select</code> and <code>groupBys</code> that a color is required for.
The <code>context</code> object has the following structure:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>select</code></td>
<td><code>string</code></td>
<td>The alias given to the aggregation you <a href="#aggregations">selected in the query</a>.</td>
</tr>
<tr>
<td><code>groupBys</code></td>
<td><code>object</code></td>
<td>An object containing the requested groupBy value keyed by the groupBy name <a href="#group-by">specified in the query</a>.</td>
</tr>
</tbody>
</table>
<p>Note. When a legend is visible on a chart and a groupBy is defined on the query. The <code>colors</code> function will be called to define a color for each legend item, as the legend item is only related to the <code>select</code> the <code>groupBys</code> property will be <code>null</code> in that specific <code>context</code>.</p>
<h2 id="gauge-visualization">Gauge visualization</h2>
<p data-height="300" data-theme-id="17963" data-slug-hash="LVoOJr" data-default-tab="result" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/LVoOJr/">Connect Gauge viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>Gauge visualizations can be generated for basic queries.  You cannot create a gauge viz for queries with <a href="#group-by">groups</a> or
<a href="#time-intervals">time intervals</a> - doing so will display an &quot;unsupported query&quot; error on the visualization.</p>
<h3 id="gauge-options">Gauge options</h3>
<p>As well as the setting of <a href="#field-options">field options</a> (which all visualizations support), you must specify gauge options to configure the viz:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample87" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample87"><pre><code class="lang-js">var gauge = Connect.visualize(query)
    .as(&apos;guage&apos;)
    .inside(&apos;#gauge&apos;)
    .with({
        gauge: {
            min: 0,
            max: &apos;total&apos;
            color: &apos;#2980b9&apos;,
            padding:{
                top: 5,
                right: 10,
                bottom: 5,
                left: 10
            },
            label: {
                format: &apos;$,.2f&apos;
            }
        }
    })
    .draw();
</code></pre></div></div></div>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>min</code></td>
<td><code>string</code> or <code>number</code></td>
<td>Specifies the minimum value of the chart.  This can either be a string name of a field in a resultset, or a static number.</td>
</tr>
<tr>
<td><code>max</code></td>
<td><code>string</code> or <code>number</code></td>
<td>Specifies the maximum value of the chart.  This can either be a string name of a field in a resultset, or a static number.</td>
</tr>
<tr>
<td><code>color</code></td>
<td><code>string</code></td>
<td>The color of the data arc of the gauge.</td>
</tr>
<tr>
<td><code>padding</code></td>
<td><code>object</code></td>
<td>The padding around the gauge (left, right, top and bottom).</td>
</tr>
<tr>
<td><code>label.format</code></td>
<td><code>string</code> or <code>function</code></td>
<td>Either a format string, or alternatively a function accepting a single value argument that returns a formatted string. See <a href="#formatters">Formatters</a> for more info.</td>
</tr>
</tbody>
</table>
<h2 id="field-options">Field options</h2>
<p>All visualizations allow specifying field options which describe the way in which aggregated values and grouped fields are displayed in the viz.</p>
<p>Field options are keyed by select or grouped field, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample88" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample88"><pre><code class="lang-js">var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;);

var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .with({
        chart: {
            type: &apos;bar&apos;
        },
        fields: {
            totalSales: {
                label: &apos;Total Sales ($)&apos;,
                format: &apos;$,.2f&apos;
            },
            product: {
                label: &apos;Products&apos;,
                format: function(value){
                    return value === &apos;Some product name&apos; ? &apos;Ours&apos; : value;
                }
            }
        }
    })
    .draw();
</code></pre></div></div></div>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td><code>string</code></td>
<td>A &quot;friendly&quot; label for the select or grouped field.  This may be displayed in a legend, tooltip, etc. depending on the viz type.</td>
</tr>
<tr>
<td><code>format</code></td>
<td><code>string</code> or <code>function</code></td>
<td>Either a format string, or alternatively a function accepting a single value argument that returns a formatted string. See <a href="#formatters">Formatters</a> for more info.</td>
</tr>
</tbody>
</table>
<h2 id="formatters">Formatters</h2>
<p>Many of the viz types allow you to pass either a format string or a format function that converts a number to its string representation. 
When you pass a format string the d3 format function is used. You can find the <a href="https://github.com/mbostock/d3/wiki/Formatting">d3 formatting specifictaions here. </a>
An example of providing a format string:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample89" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample89"><pre><code class="lang-js">var fieldOptions = {
    totalSales: {
        //...
        format: &apos;$,.2f&apos;
    }
};
</code></pre></div></div></div>
<p>If you wish to have complete control over the formatting, you can provide your own format function.  The function must accept a value as an argument and return the formatted string.
This gives you the ability to use other third-party libraries for formatting. For example, you could format currency values using
<a href="http://numeraljs.com/">Numeral.js</a>:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample90" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample90"><pre><code class="lang-js">var currencyFormatter = function (value){
    return numeral(value).format(&apos;$0.0a&apos;);
};

var fieldOptions = {
    totalSales: {
        //...
        format: currencyFormatter
    }
};
</code></pre></div></div></div>
<h2 id="interval-options">Interval options</h2>
<p>All visualizations allow specifying interval options when executing a query with <a href="#time-intervals">time intervals</a>.  This controls the formatting
of title labels (i.e. in the <a href="#table-viz">table viz</a>) and labels for the interval values themselves.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>label</code></td>
<td><code>string</code></td>
<td>A &quot;friendly&quot; label or title for the interval.  This only applies to the <a href="#table-viz">table viz</a> (for the column heading).</td>
</tr>
<tr>
<td><code>format</code></td>
<td><code>string</code>, <code>object</code> or <code>function</code></td>
<td>Either a <a href="http://momentjs.com/docs/#/displaying/format/">moment.js format string</a>, an object keyed by <a href="#time-intervals">time interval</a> with <a href="http://momentjs.com/docs/#/displaying/format/">moment.js format strings</a> or a function taking the start and optionally the end date of an interval and returning a formatted string.</td>
</tr>
</tbody>
</table>
<p>The simplest way to format the date for an Interval is to set the <code>format</code> property with a <a href="http://momentjs.com/docs/#/displaying/format/">moment.js format string. </a> For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample91" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample91"><pre><code class="lang-js">var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;)
    .interval(&apos;monthly&apos;);

var table = Connect.visualize(query)
    .as(&apos;table&apos;)
    .inside(&apos;#table&apos;)
    .with({
        title: &apos;Product Sales by Month&apos;,
        intervals: {
            label: &apos;Month&apos;,
            format: &apos;MMM YYY&apos;
        }
    })
    .draw();
</code></pre></div></div></div>
<p>Your options may be used with different queries that have different intervals. If you wish to override the format for specific intervals you can supply the <code>format</code> property with an object that contains <a href="http://momentjs.com/docs/#/displaying/format/">moment.js format strings</a> keyed by <a href="#time-intervals">time interval. </a> For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample92" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample92"><pre><code class="lang-js">var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;)
    .interval(&apos;monthly&apos;);

var table = Connect.visualize(query)
    .as(&apos;table&apos;)
    .inside(&apos;#table&apos;)
    .with({
        title: &apos;Product Sales by Month&apos;,
        intervals: {
            label: &apos;Month&apos;,
            format: {
                monthly: &apos;MMM YYYY&apos;,
                yearly: &apos;YY&apos;
            }
        }
    })
    .draw();
</code></pre></div></div></div>
<p>Alternatively, if you would like full control over formatting, you can provide the <code>format</code> property with a function that accepts a start date and optionally an end date as arguments and returns a formatted string. 
Both the start date and optional end date arguments will be native JavaScript date objects.
For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample93" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample93"><pre><code class="lang-js">var query = connect.query(&apos;purchases&apos;)
    .select({
        totalSales: { sum: &apos;purchasePrice&apos; }
    })
    .groupBy(&apos;product&apos;)
    .interval(&apos;monthly&apos;);

var table = Connect.visualize(query)
    .as(&apos;table&apos;)
    .inside(&apos;#table&apos;)
    .with({
        title: &apos;Product Sales by Month&apos;,
        intervals: {
            label: &apos;Month&apos;,
            format: function (startValue) {
                return startValue.toString();
            }
        }
    })
    .draw();
</code></pre></div></div></div>
<h2 id="visualization-lifecycle">Visualization lifecycle</h2>
<p>After you have created a viz, you should manage its lifecycle in your app, including <a href="#refreshing-visualizations">refreshing the data</a>,
<a href="#updating-visualizations">updating</a> or <a href="#destroying-visualizations">destroying</a> it.</p>
<h3 id="refreshing-visualizations">Refreshing visualizations</h3>
<p>If you wish to refresh the data in a viz (i.e. execute the query again for fresh data), you can call the <code>refresh()</code> function
on the created viz.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample94" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample94"><pre><code class="lang-js">var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .draw();
//...
chart.refresh();
</code></pre></div></div></div>
<p>Many visualizations support smooth transitions/animations when data is refreshed.  You may also wish to refresh visualizations on a timer to
simulate streaming, real-time data.</p>
<p>The loading animation will <strong>not</strong> be shown when refreshing visualizations.  You should <a href="#updating-visualizations">update the viz</a> if you wish
this to display.</p>
<h3 id="updating-visualizations">Updating visualizations</h3>
<p>You can also update visualizations with a new <strong>query</strong> or <strong>function returning a promise</strong> by calling the <code>update()</code> function on the created
viz.  This is useful in scenarios, for example, where an end user changes a filter.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample95" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample95"><pre><code class="lang-js">var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .draw();
//...
chart.update(newQuery);
</code></pre></div></div></div>
<p>The loading animation <strong>will</strong> be shown when updating visualizations and any pending queries for the viz will be cancelled/overridden by
this action.</p>
<h3 id="destroying-visualizations">Destroying visualizations</h3>
<p>If a viz is no longer needed in your app, or it needs to be completely replaced with a newly created one, it is important that
you clean up the viz.</p>
<p>Simply removing the viz from the DOM is <strong>not sufficient</strong> and may cause memory leaks in your app.</p>
<p>To destroy a viz, simply call the <code>destroy()</code> function on the created viz.  For example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample96" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample96"><pre><code class="lang-js">var chart = Connect.visualize(query)
    .as(&apos;chart&apos;)
    .inside(&apos;#chart&apos;)
    .draw();

chart.destroy();
</code></pre></div></div></div>
<h2 id="custom-visualizations">Custom visualizations</h2>
<p>You can register your own custom visualizations to take advantage of the regular viz lifecycle which the included visualizations use.
This means your viz will automatically handle:</p>
<ul>
<li>Loading animations</li>
<li>Handle queries or functions that return promises</li>
<li>Handling out of order query results returned from the API</li>
<li>Refreshing/updating</li>
<li>Destruction</li>
<li>Error handling</li>
</ul>
<p>For example:</p>
<p data-height="300" data-theme-id="17963" data-slug-hash="MwdRoO" data-default-tab="result" data-user="getconnect" class="codepen">See the Pen <a href="http://codepen.io/getconnect/pen/MwdRoO/">Connect Custom viz</a> by Connect (<a href="http://codepen.io/getconnect">@getconnect</a>) on <a href="http://codepen.io">CodePen</a>.</p>

<p>A custom viz should supply an implementation for the following contract:</p>
<p><code>init(container, options)</code> <em>(optional)</em></p>
<p>This function is only called during initialization and should implement any initial DOM rendering before the query results
have been received.  Any changes to the DOM during this method will appear even while the loading animation is displayed over
the top.</p>
<p><code>render(container, results, options, wasQueryUpdated)</code></p>
<p>This function is called whenever a new result set is available.  The bulk of the viz rendering logic should be in this
function.  <code>results</code> contains the standard result set returned from a query (including <a href="#metadata">metadata</a>).
<code>wasQueryUpdated</code> will indicate whether or not this is a mere refresh or whether the entire result set has changed
(e.g. due to a completely different query). This function is not optional, if it is not provided the custom viz will not be registered.</p>
<p><code>redraw()</code> <em>(optional)</em></p>
<p>This function is called when the <code>redraw</code> function is manually called on a viz.  This should be defined if the
viz must manually respond to changes in the size of the viz container.  The <code>redraw</code> function is commonly
used if a viz has been initially rendered when its container is not visible.</p>
<p><code>destroy()</code> <em>(optional)</em></p>
<p>This function is called when the viz is being <a href="#destroying-visualizations">destroyed</a>.  Any DOM elements will be removed
automatically; however, you should define this function if any extra &quot;clean up&quot; is required (e.g. removing listeners,
freeing objects, etc.)</p>
<p><code>defaultOptions()</code> <em>(optional)</em></p>
<p>This function is called when the viz is being first created, before <code>init</code> is called. If your vizualization needs some default options you should return them here as an object. The options that are passed to both <code>init</code> and <code>render</code> will be a union of any default options returned here and the options provided when the custom vizualization is instantiated. User provided options will take precedence over default options.</p>
<p><code>isSupported(metadata, selects)</code> <em>(optional)</em></p>
<p>Not all visualizations can handle all types of results.  For example, the <a href="#text-viz">text viz</a>, cannot handle query results
with <a href="#group-by">groups</a> or <a href="#time-intervals">time intervals</a>.  In these cases, the viz will gracefully display a
&quot;query not supported&quot; error.</p>
<p>You can include your own logic as to whether your custom viz can support the specified <code>metadata</code> and <code>selects</code> by returning a boolean for this function.<br>The <code>metadata</code> argument will be the metadata returned by a query (which is defined here. <a href="#metadata">metadata</a>) The <code>selects</code> argument will be an array of the aliases given to the aggregations selected in the query.
By default, if no function is provided, all types of query results are assumed to be supported.</p>
<p><code>cssClasses(options)</code> <em>(optional)</em></p>
<p>This function is called when the viz is being first created, before <code>init</code> is called. The provided function should return an array of strings that will then be added to the target element of the visualization as classes. This is usefull for dynamically setting class names based on the options provided. There are also a few useful predefined CSS classes you can add to change the styling behavior of the viz:</p>
<ul>
<li><code>grow-results</code> - grow the viz&apos;s height to fill the entire available height.</li>
<li><code>center-results</code> - center the viz&apos;s results vertically.</li>
</ul>
<p>Once you have implemented the contract, you register the custom viz using <code>Connect.registerViz</code>, for example you could provide an object that contains the appropriate functions:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample97" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample97"><pre><code class="lang-js">Connect.registerViz(&apos;myViz&apos;, {
    init: function(container, options) {

    },
    render: function(container, results, options, hasQueryUpdated) {

    }
});

// The custom viz can then be used in the same manner as the built in ones.

Connect.visualize(query)
    .as(&apos;myViz&apos;)
    .inside(&apos;#custom-viz&apos;)
    .draw();
</code></pre></div></div></div>
<p>Or alternatively if you can provide the <code>Connect.registerViz</code> with a factory function. As an example if you using ES6 and classes you might do the following:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample98" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample98"><pre><code class="lang-js">
class MyViz {

    init(container, options) {

    }

    render(container, results, options, hasQueryUpdated) {

    }

}

Connect.registerViz(&apos;myViz&apos;, () =&gt; new MyViz);

// The custom viz can then be used in the same manner as the built in ones.

Connect.visualize(query)
    .as(&apos;myViz&apos;)
    .inside(&apos;#custom-viz&apos;)
    .draw();
</code></pre></div></div></div>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<h1 id="deleting-collections">Deleting collections</h1>
<p>Currently, this SDK does not support deleting collections.</p>
<p>However, you can use the one of the following methods to delete collections if required:</p>
<ul>
<li><a href="https://app.getconnect.io/">Via the admin console</a></li>
<li><a href="http#deleting-collections">With the HTTP API</a></li>
</ul>
<h1 id="projects-and-keys">Projects and keys</h1>
<p>Connect allows you to manage multiple projects under a single account so that you can easily segregate
your collections into logical projects.</p>
<p>You could use this to separate analytics for entire projects, or to implement separation between different
environments (e.g. My Project (Prod) and My Project (Dev)).</p>
<p>To start pushing and querying your event data, you will need both a project ID and an API key.  This information
is available to you <a href="http://app.getconnect.io/#/projects">via the admin console</a> inside each project under the &quot;Keys&quot; tab:</p>
<p><img src="images/screens/projects-keys.png" alt="Screenshot of project keys in Connect admin console"></p>
<p>By default, you can choose from four different types of keys, each with their own specific use:</p>
<ul>
<li><p><code>Push/Query Key</code> - you can use this key to both push events and execute queries.<br>You should only use this key in situations where it is not possible to isolate merely pushing or querying.</p>
</li>
<li><p><code>Push Key</code> - you can only use this key to push events.<br>You should use this key in your apps where you are tracking event data, but do not require querying.</p>
</li>
<li><p><code>Query Key</code> - you can only use this key to execute queries.<br>You should use this key in your reporting interfaces where you do not wish to track events.</p>
</li>
<li><p><code>Master Project Key</code> - you can use this key to execute all types of operations on a project, including
pushing, querying and deleting collections.<br><strong>Keep this key safe</strong> - it is intended for very limited use and definitely should not be included in your main apps.</p>
</li>
</ul>
<p>You must use your project ID and desired key to begin using Connect:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample99" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample99"><pre><code class="lang-js">var Connect = require(&apos;connect-js&apos;);

var connect = new Connect({
    projectId: &apos;YOUR_PROJECT_ID&apos;,
    apiKey: &apos;YOUR_API_KEY&apos;
});
</code></pre></div></div></div>








<h1 id="security">Security</h1>
<p>Security is a vital component to the Connect service and we take it very seriously.  It is important to consider
how to ensure your data remains secure.</p>
<h2 id="api-keys">API Keys</h2>
<p>API keys are the core security mechanisms by which you can <a href="#pushing-events">push</a> and <a href="#querying-events">query</a>
your data.  It is important to keep these keys safe by controlling where these keys exist and who has access to them.</p>
<p>Each key can either push, query or both.  The most important key is the <code>Project Master Key</code> which can perform all of
these actions, as well as administrative functions such as deleting data.  Read more about the keys <a href="#projects-and-keys">here</a>.</p>
<h2 id="keeping-api-keys-secure">Keeping API Keys Secure</h2>
<p>You should carefully consider when and which API keys to expose to users.</p>
<p>Crucially, you should <strong>never</strong> expose your <code>Project Master Key</code> to users or embed it in client applications.
If this key does get compromised, you can <a href="#resetting-the-master-key">reset it</a>.</p>
<p>If you embed API keys in client applications, you should consider these keys as fully accessible to anyone having access
to that client application.  This includes both mobile and web applications.</p>
<h2 id="pushing-events-securely">Pushing events securely</h2>
<p>While you can use a <code>Push Key</code> to prevent clients from querying events, you cannot restrict the collections or events
clients can push to the API.  Unfortunately, this is the nature of tracking events directly client-side and opens the
door to malicious users potentially sending bad data.</p>
<p>In many circumstances, this is not an issue as users can already generate bad data simply by using your application in
an incorrect way, generating events with bad or invalid data.  In circumstances where you absolutely cannot withstand
bad event data, you should consider pushing the events server-side from a service under your control.</p>
<p>Finally, if a <code>Push Key</code> is compromised or being used maliciously, you can always reset it by <a href="#resetting-the-master-key">resetting the master key</a>.</p>
<h2 id="querying-events-securely">Querying events securely</h2>
<p>To query events, you must use an API key that has query permissions.  By default, a <code>Query Key</code> has full access to all
events in all collections in your project.  If this key is exposed, a client could execute any type of query on your
collections.</p>
<p>You have a number of options on querying events securely:</p>
<ol>
<li><p>For internal querying or dashboard, you may consider it acceptable to expose the normal <code>Query Key</code> in client applications.
Keep in mind that this key can execute any query on any collection in the project.</p>
</li>
<li><p>Generate a <a href="#filtered-keys">filtered key</a>, which applies a specific set of filters to all queries executed by clients
with the key.</p>
</li>
<li><p>Only allow clients to execute queries via a service you control, which in turn executes queries via the Connect API server-side.</p>
</li>
</ol>
<p>Finally, if a <code>Query Key</code> is compromised or being used maliciously, you can always reset it by <a href="#resetting-the-master-key">resetting the master key</a>.</p>
<h2 id="resetting-the-master-key">Resetting the master key</h2>
<p>Resetting the <code>Project Master Key</code> will invalidate the previous key and generate a new, random key.  This action will also
reset all other keys for the project (including the push, query and any <a href="#filtered-keys">filter keys</a> generated).</p>
<p>Doing this is <strong>irreversible</strong> and would prevent all applications with existing keys from pushing to or querying the project.</p>
<p>You can only reset the master key in the projects section of the <a href="http://app.getconnect.io">admin console</a>.</p>
<h2 id="filtered-keys">Filtered keys</h2>
<p>Filtered keys allows you to create an API key that can either push or query, and in the case of querying,
apply one or more <a href="#filters">filters</a> to all queries executed with the key.</p>
<p>This allows you to have finer control over security and what data clients can access, especially in multi-tenant
environments.</p>
<blockquote>
<p><strong>Filters are only applied to queries</strong></p>
<p>Any filters specified in your filtered key only apply to querying.  We currently do not support applying
filters to restrict the pushing of events.</p>
</blockquote>
<p>Filtered keys can only push or query (as you specify), <em>never</em> administrative functions or deleting data.  </p>
<h3 id="generating-a-filtered-key">Generating a filtered key</h3>
<p>Filtered keys are generated and encrypted with the <code>Project Master Key</code>.  You do not have to register the
filtered key with the Connect service.</p>
<p>It is important that you <strong>never</strong> generate filtered keys client-side and always ensure the are generated by a secure,
server-side service.</p>
<ol>
<li><p>Create a JSON object describing the access allowed by the key, including any <a href="#filters">filters</a>, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample108" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample108"><pre><code class="lang-json">{
    &quot;filters&quot;: {
        &quot;customerId&quot;: 1234
    },
    &quot;canQuery&quot;: true,
    &quot;canPush&quot;: false
}
</code></pre></div></div></div>
 <table>
     <tr>
         <th>Property</th>
         <th>Type</th>
         <th>Description</th>
     </tr>
     <tr>
         <td><code>filters</code></td>
         <td><code>object</code></td>
         <td>The filters to apply all queries executed when using the key.  This uses the same specification for <a href="#filters">defining filters</a> when querying normally.</td>
     </tr>
     <tr>
         <td><code>canQuery</code></td>
         <td><code>boolean</code></td>
         <td>Whether or not the key can be used to execute queries.  If <code>false</code>, the <code>filters</code> property is ignored (as it does not applying to pushing).</td>
     </tr>
     <tr>
         <td><code>canPush</code></td>
         <td><code>boolean</code></td>
         <td>Whether or not the key can be used to push events.</td>
     </tr>
 </table>
</li>
<li><p>Serialize the JSON object to a string.</p>
</li>
<li><p>Generate a random 128-bit initialization vector (IV).</p>
</li>
<li><p>Encrypt the JSON string using AES256-CBC with PKCS7 padding (128-bit block size) using the 128-bit random IV we generated in the previous step
and the <code>Project Master Key</code> as the encryption key.</p>
</li>
<li><p>Convert the IV and cipher text to hex strings and combine them (IV first, followed by the cipher text), separating them with a hyphen (-). The resulting
key should look something like this:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample109" role="tab" data-toggle="tab" data-lang="">Not Found</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample109"><pre><code class="nohighlight">5D07A77D87D5B20FA5508303F748A43B-DDFA284A9341068A704A846E83ACF49069D960632C4F74A44B5EE330073F79A8324ADC91023F88F63AAE4507F3D119B5C7F31A2D7D9616408E9665EC6C1DEBE3
</code></pre></div></div></div></li>
</ol>
<p>You can now use this API key to either <a href="#pushing-events">push events</a> or <a href="#querying-events">execute queries</a> depending on the <code>canPush</code>
and <code>canQuery</code> properties, respectively.</p>
<p>Finally, if a filtered key is compromised or being used maliciously, you can always reset it by <a href="#resetting-the-master-key">resetting the master key</a>.</p>
<h1 id="modeling-your-events">Modeling your events</h1>
<p>When using Connect to analyze and visualize your data, it is important to understand how best to model your events.
The way you structure your events will directly affect your ability to answer questions with your data.  It is therefore
important to consider up-front the kind of questions you anticipate answering.</p>
<h2 id="what-is-an-event-">What is an event?</h2>
<p>An event is an action that occurs at a specific point in <strong>time</strong>. To answer &quot;why did this event occur?&quot;, our event needs
to contain rich details about what the &quot;world&quot; looked like at that point in time.</p>
<p>Put simply, events = action + time + state.</p>
<p>For example, imagine you are writing an exercise activity tracker app.  We want to give users of your app the ability to
analyze their performance over time.  This is an event produced by our hypothetical activity tracker app:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample110" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample110"><pre><code class="lang-json">{
    &quot;type&quot;: &quot;cycling&quot;,
    &quot;timestamp&quot;: &quot;2015-06-23T16:31:56.587Z&quot;,
    &quot;duration&quot;: 67,
    &quot;distance&quot;: 21255,
    &quot;caloriesBurned&quot;: 455,
    &quot;maxHeartRate&quot;: 182,
    &quot;user&quot;: {
        &quot;id&quot;: &quot;638396&quot;,
        &quot;firstName&quot;: &quot;Bruce&quot;,
        &quot;lastName&quot;: &quot;Jones&quot;,
        &quot;age&quot;: 35
    }
}
</code></pre></div></div></div>






<h3 id="action">Action</h3>
<p>What happened? In the above example, the action is <em>an activity was completed</em>.</p>
<p>In most circumstances, we <a href="#collections">group all events of the same action into a single collection</a>.
In this case, we could call our collection <code>activityCompleted</code>, or alternatively, just <code>activity</code>.</p>
<h3 id="time">Time</h3>
<p>When did it happen? In the above example, we specified the start time of the activity as the value of the <strong>timestamp</strong> property.
The top-level <strong>timestamp</strong> property is a special property in Connect.  This is because <em>time</em> is an essential property of event
data - it&apos;s not optional.</p>
<p>When an event is pushed to Connect, the current time is assigned to the timestamp property if no value was provided by you.</p>
<h3 id="state">State</h3>
<p>What do we know about this action?  What do we know about the entities associated with this action?  What do we know about the &quot;world&quot;
at this moment in time?  Every property in our event, besides the timestamp and the name of the collection, serves to answer those
questions.  This is the most important aspect of our event - it&apos;s where all the answers live.</p>
<p>The richer the data you provide in your event, the more questions you can answer for your users, therefore it&apos;s important to enrich
your events with as much information as possible.  In stark contrast to the relational model where you would store this related
information in separate tables and join at query time, in the event model this data is denormalized into each event, so as to know
the state of the &quot;world&quot; at the point in time of the event.</p>
<h2 id="collections">Collections</h2>
<p>It is important when modeling your events to consider how you intend to group those events into collections.  This is a careful balance between events being
broad enough to answer queries for your users, while specific enough to be manageable.</p>
<p>In our <a href="#what-is-an-event-">activity example</a>, the activity contains different properties based on what the type of activity.  Our cycling activity contains properties associated
with the bike that was used, while a kayaking activity may contain properties associated with a kayak that is used.</p>
<p>Because a kayaking event may have different properties to a running event, it might seem logical to put each of them in distinct collections.  However, if we
had distinct <code>cycling</code>, <code>running</code> and  <code>kayaking</code> collections, we would lose the opportunity to query details that are common to all activities.</p>
<p>As a general rule, consider the common action among your events and decide if the specific variants of that action warrant grouping those events together. </p>
<h2 id="structuring-your-events">Structuring your events</h2>
<p>Events have the following core properties:</p>
<ul>
<li>Denormalized</li>
<li>Immutable</li>
<li>Rich/nested</li>
<li>Schemaless</li>
</ul>
<p>It is also important to consider how to group events into collections to enable future queries to be answered.</p>
<h3 id="events-are-denormalized">Events are denormalized</h3>
<p>Consider our example event again, notice the age property of the user:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample117" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample117"><pre><code class="lang-json">{
    &quot;type&quot;: &quot;cycling&quot;,
    ...
    &quot;user&quot;: {
        &quot;id&quot;: &quot;638396&quot;,
        &quot;firstName&quot;: &quot;Bruce&quot;,
        &quot;lastName&quot;: &quot;Jones&quot;,
        &quot;age&quot;: 35
    }
}
</code></pre></div></div></div>






<p>The user&apos;s age is going to be duplicated in every activity he/she completes throughout the year. This may seem inefficient; however,
remember that Connect is about <strong>analyzing</strong>.  This denormalization is a real win for analysis; the key is that event data stores state
over time, rather than merely current state.  This helps us answer questions about <em>why</em> something happened, because we know what the
&quot;world&quot; looked like at that point of time.</p>
<p>For example imagine we wanted to chart the average distance cycled per ride, grouped by the age of the rider at the time of the ride.
We could simply execute the following query:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample124" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample124"><pre><code class="lang-js">var query = connect.query(&apos;activity&apos;)
  .select({ averageDistance: { avg: &apos;distance&apos; } })
  .groupBy(&apos;user.age&apos;);

var chart = connect.chart(query, &apos;#chart&apos;, {
    title: &apos;Average distance per activity by age&apos;,
    chart: { type: &apos;bar&apos; }
});
</code></pre></div></div></div>


<p>It&apos;s this persistence of state over time that makes event data perfect for analysis.</p>
<h3 id="events-are-immutable">Events are immutable</h3>
<p>By their very nature, events cannot change, as they always record state at the point in time of the event.  This is also the reason to
record as much rich information about the event and &quot;state of the world&quot; as possible.</p>
<p>For example, in our example event above, while Bruce Jones may now be many years older, at the time he completed his bike ride, he was
35 years of age.  By ensuring this event remains immutable, we can correctly analyze bike riding over time by 35-year-olds.</p>
<p>Consider events as recording history - as much as we&apos;d occasionally like to, we can&apos;t change history!</p>
<h3 id="events-are-rich-and-nested">Events are rich and nested</h3>
<p>Events are rich in that they specify very detailed state.  They specify details about the event itself, the entities involved and the state of
the &quot;world&quot; at that point in time. </p>
<p>Consider our example activity event - the top level <strong>type</strong> property describes something about the activity itself (a run, a bike ride, a kayak
etc.).  The user property specifies rich information about the actor who performed the event.  In this case it&apos;s the person who completed the
activity, complete with their name and age.</p>
<p>In reality, though, we may decide to include a few other nested entities in our event, for example:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample127" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample127"><pre><code class="lang-json">{
    &quot;type&quot;: &quot;cycling&quot;,
    ...
    &quot;user&quot;: {
        &quot;id&quot;: &quot;638396&quot;,
        &quot;firstName&quot;: &quot;Bruce&quot;,
        ...
    },
    &quot;bike&quot;: {
        &quot;id&quot;: &quot;231806&quot;,
        &quot;brand&quot;: &quot;Specialized&quot;,
        &quot;model&quot;: &quot;S-Works Venge&quot;
    },
    &quot;weather&quot;: {
        &quot;condition&quot;: &quot;Raining&quot;,
        &quot;temperature&quot;: 21,
        &quot;humidity&quot;: 99,
        &quot;wind&quot;: 17
    }
}
</code></pre></div></div></div>






<p>Note our event now includes details about the bike used and the weather conditions at the time of the activity.  By adding this extra bike state information
to our event, we have opened up extra possibilities for interrogating our data. For example, we can now query the average distance cycled by each model of bike
that was built by &quot;Specialized&quot;:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample134" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample134"><pre><code class="lang-js">var query = connect.query(&apos;activity&apos;)
  .select({ averageDistance: { avg: &apos;distance&apos; } })
  .groupBy(&apos;bike.model&apos;);
  .filter({
    &apos;bike.brand&apos;: &apos;Specialized&apos;
  });
</code></pre></div></div></div>


<p>The weather also provides us with exciting insights - what did the world look like at this point in time?  What was the weather like?  Storing this data
allows us to answer yet more questions.  We can test our hypothesis that &quot;older people are less scared of riding in the rain&quot; by simply charting the
following query:</p>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample137" role="tab" data-toggle="tab" data-lang="js">JavaScript</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample137"><pre><code class="lang-js">var query = connect.query(&apos;activity&apos;)
  .select({ averageDistance: { avg: &apos;distance&apos; } })
  .groupBy([&apos;user.age&apos;, &apos;weather.condition&apos;]);
</code></pre></div></div></div>


<p>As you can see, the richer and more denormalized the event, the more interesting answers can be derived when later querying.</p>
<h3 id="events-are-schemaless">Events are schemaless</h3>
<p>Events in Connect should be considered semi-structured - that is, they have an inherent structure, but it is not defined.  This means you can, and should,
push as much detailed information about an event and the state of the &quot;world&quot; as possible.  Moreover, this allows you to improve your schema over time and
add extra information about new events as that information becomes available.</p>
<h2 id="restrictions">Restrictions</h2>
<p>While you can post almost any event structure to Connect, there are a few, by-design restrictions.</p>
<h3 id="property-names">Property names</h3>
<ul>
<li><p>You cannot have any property in the root document beginning with &quot;tp_&quot;. This is because we prefix our
own internal properties with this. Internally, we merge our properties into your events for performance
at query time.</p>
</li>
<li><p>The property &quot;_id&quot; is reserved and cannot be pushed.</p>
</li>
<li><p>The properties &quot;id&quot; and &quot;timestamp&quot; have special purposes. These allow consumers to specify a unique ID
per event and override the event&apos;s timestamp respectively.  You cannot use the &quot;id&quot; property in queries.
Refer to <a href="#reliability-of-events">&quot;reliability of events&quot;</a> and <a href="#timestamps">&quot;timestamps&quot;</a> for information.</p>
</li>
<li><p>The length of property names can&apos;t exceed 255 characters.  If you need property names longer than this, you
probably <a href="#structuring-your-events">need to reconsider the structure of your event!</a></p>
</li>
<li><p>Properties cannot include a dot in their names.  This is because dots are used in querying to access nested
properties.  The following is an example of an invalid event property due to a dot in the name:</p>
</li>
</ul>
<div class="code-samples"><ul class="nav hide"><li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"></a><ul class="dropdown-menu"><li class="active"><a href="#code-sample140" role="tab" data-toggle="tab" data-lang="json">JSON</a></li></ul></li></ul><div class="tab-content"><div class="tab-pane active" id="code-sample140"><pre><code class="lang-json">{
    &quot;invalid.property&quot;: &quot;value&quot;
}
</code></pre></div></div></div>






<h3 id="arrays">Arrays</h3>
<p>While you can create events with arrays, it is currently not possible to take advantage of these arrays at
query time.  Therefore, you should avoid using arrays in your events unless you plan to export the raw events.</p>
<h3 id="distinct-count">Distinct count</h3>
<p>Distinct count is currently not supported for querying, therefore you should consider how to structure your
event if your application relies on this.</p>

    </div>
  </div>  
</div>

    </div>
    
    <footer>
      <nav class="footer-nav navbar navbar-inverse" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand hidden-xs navbar-brand active" href="http://getconnect.io">
              <div class="brand-logo-small"></div>
            </a>
          </div>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://app.getconnect.io/#/projects">Projects</a></li>
            <li><a href="https://app.getconnect.io/#/settings">Settings</a></li>
            <li><a href="http://docs.getconnect.io/">Docs</a></li>
            <li>
              <a href="https://github.com/getconnect">
                <span class="ion ion-social-github"></span>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/getconnect_io">
                <span class="ion ion-social-twitter"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </footer>
    
    <div class="status">
		    <a href="http://status.getconnect.io" target="_blank">
		      <span class="color-dot"></span>
		      <span class="color-description"></span>
		    </a>
		</div>
    
    <script src="https://statuspage-production.s3.amazonaws.com/se-v1.js"></script>
    <script src="scripts/highlight.pack.min.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/svg-injector.min.js"></script>
    <script src="scripts/docs.min.js"></script>
    <script async src="scripts/analytics.min.js"></script>
  </body>
</html>