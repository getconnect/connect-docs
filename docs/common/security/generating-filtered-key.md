### Generating a filtered key

Filtered keys are generated and encrypted with the `Project Master Key`.  You do not have to register the
filtered key with the Connect service.

It is important that you **never** generate filtered keys client-side and always ensure the are generated by a secure,
server-side service.

1. Create a JSON object describing the access allowed by the key, including any [filters](#filters), for example:

   ```json
   {
	   "filters": {
		   "customerId": 1234
	   },
	   "canQuery": true,
	   "canPush": false
   }
   ```
   
	<table>
		<tr>
			<th>Property</th>
			<th>Type</th>
			<th>Description</th>
		</tr>
		<tr>
			<td>`filters`</td>
			<td>`object`</td>
			<td>The filters to apply all queries executed when using the key.  This uses the same specification for [defining filters](#filters) when querying normally.</td>
		</tr>
		<tr>
			<td>`canQuery`</td>
			<td>`boolean`</td>
			<td>Whether or not the key can be used to execute queries.  If `false`, the `filters` property is ignored (as it does not applying to pushing).</td>
		</tr>
		<tr>
			<td>`canPush`</td>
			<td>`boolean`</td>
			<td>Whether or not the key can be used to push events.</td>
		</tr>
	</table>

2. Serialize the JSON object to a string.

3. Generate a random 128-bit initialization vector (IV).

4. Encrypt the JSON string using AES256-CBC with PKCS7 padding (128-bit block size) using the 128-bit random IV we generated in the previous step
   and the `Project Master Key` as the encryption key.

5. Convert the IV and cipher text to hex strings and combine them (IV first, followed by the cipher text), separating them with a hyphen (-). The resulting
   key should look something like this:
   
   ```
   5D07A77D87D5B20FA5508303F748A43B-DDFA284A9341068A704A846E83ACF49069D960632C4F74A44B5EE330073F79A8324ADC91023F88F63AAE4507F3D119B5C7F31A2D7D9616408E9665EC6C1DEBE3
   ```

You can now use this API key to either [push events](#pushing-events) or [execute queries](#querying-events) depending on the `canPush`
and `canQuery` properties, respectively.

Finally, if a filtered key is compromised or being used maliciously, you can always reset it by [resetting the master key](#resetting-the-master-key).
